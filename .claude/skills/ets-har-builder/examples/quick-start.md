# 快速开始指南

## 场景：为使用 crypto-js 的 HAR 模块生成依赖

假设你有一个 HarmonyOS HAR 模块，使用了 crypto-js 库：

```typescript
// src/main/ets/utils/CryptoUtils.ets
import { CryptoJS } from '@ohos/crypto-js';

export class CryptoUtils {
  static encrypt(data: string): string {
    return CryptoJS.enc.Utf8.parse(data).toString(CryptoJS.enc.Base64);
  }
}
```

### 步骤 1: 编译 ets-har-builder

```bash
cd D:\code\ets-har-builder\ets-har-builder
mvn package -DskipTests
```

### 步骤 2: 运行引擎处理模块

```bash
mvn exec:java -Dexec.mainClass="org.example.harmony.HarDependencyEngine" \
  -Dexec.args="D:\code\myproject\mymodule"
```

### 步骤 3: 查看生成的文件

引擎会在项目根目录生成依赖文件：

```
D:\code\myproject\
├── @ohos\
│   └── crypto-js\
│       ├── Index.d.ts           # 生成的声明文件
│       ├── oh-package.json5
│       └── build-profile.json5
```

### 步骤 4: 使用 hvigor 编译

```bash
cd D:\code\myproject\mymodule
hvigorw assembleHap
```

## 输出示例

成功运行后，你会看到类似输出：

```
? SUCCESS
  Module: D:\code\myproject\mymodule
  Dependencies generated: 1
  Output path: D:\code\myproject

The module is now ready for hvigor build.
```

## 生成的 Index.d.ts

```typescript
// Auto-generated by ets-har-builder
export default CryptoJS;
export { CryptoJS };

declare global {
    namespace CryptoJS {
        export namespace enc {
            const Utf8: Encoder;
            const Base64: Encoder;
        }
    }
}

// 定义明确的接口类型（禁止使用 object/any）
interface WordArray {
    words: number[];
    sigBytes: number;
    toString(encoder?: Encoder): string;
    clone(): WordArray;
}

interface Encoder {
    parse(str: string): WordArray;
    stringify(wordArray: WordArray): string;
}
```

## 常见问题

### Q: 如何查看引擎解析到的所有成员？

A: 启用 debug 日志级别：

```bash
mvn exec:java -Dexec.mainClass="org.example.harmony.HarDependencyEngine" \
  -Dexec.args="D:\code\myproject\mymodule" \
  -Dorg.slf4j.simpleLogger.defaultLogLevel=debug
```

### Q: 如何清理生成的文件？

A: 删除项目根目录下的依赖目录：

```bash
rm -rf D:\code\myproject\@ohos
rm -rf D:\code\myproject\@pura
```

### Q: 生成的类型不正确怎么办？

A: 你可以手动编辑生成的 Index.d.ts 文件来修正类型定义。引擎不会覆盖手动修改的文件（除非重新运行）。

### Q: 如何添加自定义类型模板？

A: 编辑 `DtsGenerator.java` 中的 `KNOWN_LIBRARY_TEMPLATES`：

```java
private static final Map<String, String> KNOWN_LIBRARY_TEMPLATES = Map.of(
    "my-custom-lib",
    """
    export interface MyType {
        prop: string;
    }
    """
);
```
